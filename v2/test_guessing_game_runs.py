import unittest

from v2.calculator import QuotientCalculator, NumericCalculator
from v2.new_guessing_game import NewAgent, NewWord, ConnectionMatrixLxC, run_simulation, shuffle_list_random_function, \
    flip_a_coin_random_function, pick_element_random_function, game_graph_with_stage_7, GameParams


class TestGuessingGameWithNumericStimulus(unittest.TestCase):
    def setUp(self) -> None:
        a0 = {'agent_id': 0, 'categories': [{'category_id': 0, 'is_active': True, 'reactive_units': [84, 6],
                                             'weights': [0.015921400274798166, 0.23460498281413217]},
                                            {'category_id': 1, 'is_active': True, 'reactive_units': [37, 37],
                                             'weights': [0.0989446631332678, 0.10549404475880782]},
                                            {'category_id': 2, 'is_active': True, 'reactive_units': [89],
                                             'weights': [0.015081478587408013]},
                                            {'category_id': 3, 'is_active': True, 'reactive_units': [73],
                                             'weights': [0.018290987207955123]},
                                            {'category_id': 4, 'is_active': True, 'reactive_units': [24],
                                             'weights': [0.0853817144935291]},
                                            {'category_id': 5, 'is_active': True, 'reactive_units': [83],
                                             'weights': [0.026061558435605453]},
                                            {'category_id': 6, 'is_active': True, 'reactive_units': [12],
                                             'weights': [0.39084377906956436]},
                                            {'category_id': 7, 'is_active': True, 'reactive_units': [9],
                                             'weights': [0.11926707131669692]},
                                            {'category_id': 8, 'is_active': True, 'reactive_units': [34],
                                             'weights': [0.05524989704930596]},
                                            {'category_id': 9, 'is_active': True, 'reactive_units': [2],
                                             'weights': [0.40856708565760835]}, {'category_id': 10, 'is_active': True,
                                                                                 'reactive_units': [75, 85, 61, 88, 65,
                                                                                                    56,
                                                                                                    89, 97],
                                                                                 'weights': [0.18834211550828,
                                                                                             0.1963395804195679,
                                                                                             0.18748653370149584,
                                                                                             0.22804678983593124,
                                                                                             0.26656038448536534,
                                                                                             0.2683075143704459,
                                                                                             0.48029800500000003,
                                                                                             0.4851495]},
                                            {'category_id': 11, 'is_active': True, 'reactive_units': [19],
                                             'weights': [0.26201521373031933]},
                                            {'category_id': 12, 'is_active': True, 'reactive_units': [61],
                                             'weights': [0.0725984531078915]},
                                            {'category_id': 13, 'is_active': True, 'reactive_units': [55],
                                             'weights': [0.09767154022075733]},
                                            {'category_id': 14, 'is_active': True, 'reactive_units': [34],
                                             'weights': [0.19029444676707766]},
                                            {'category_id': 15, 'is_active': True, 'reactive_units': [78],
                                             'weights': [0.18861832346175234]},
                                            {'category_id': 16, 'is_active': True, 'reactive_units': [49],
                                             'weights': [0.24143269967187336]},
                                            {'category_id': 17, 'is_active': True, 'reactive_units': [87],
                                             'weights': [0.21711566339590602]},
                                            {'category_id': 18, 'is_active': True, 'reactive_units': [52],
                                             'weights': [0.22152399081308644]},
                                            {'category_id': 19, 'is_active': True, 'reactive_units': [72],
                                             'weights': [0.26279824376278116]},
                                            {'category_id': 20, 'is_active': True, 'reactive_units': [60],
                                             'weights': [0.34472454293453897]}],
              'words': [{'word_id': 0, 'word_position': 0, 'active': True},
                        {'word_id': 1, 'word_position': 1, 'active': True},
                        {'word_id': 2, 'word_position': 2, 'active': True},
                        {'word_id': 3, 'word_position': 3, 'active': True},
                        {'word_id': 4, 'word_position': 4, 'active': True},
                        {'word_id': 5, 'word_position': 5, 'active': True},
                        {'word_id': 6, 'word_position': 6, 'active': True},
                        {'word_id': 7, 'word_position': 7, 'active': True},
                        {'word_id': 8, 'word_position': 8, 'active': True},
                        {'word_id': 9, 'word_position': 9, 'active': True},
                        {'word_id': 10, 'word_position': 10, 'active': True},
                        {'word_id': 11, 'word_position': 11, 'active': True},
                        {'word_id': 12, 'word_position': 12, 'active': True},
                        {'word_id': 13, 'word_position': 13, 'active': True},
                        {'word_id': 14, 'word_position': 14, 'active': True},
                        {'word_id': 15, 'word_position': 15, 'active': False},
                        {'word_id': 16, 'word_position': 16, 'active': True},
                        {'word_id': 17, 'word_position': 17, 'active': True},
                        {'word_id': 18, 'word_position': 18, 'active': True},
                        {'word_id': 19, 'word_position': 19, 'active': True},
                        {'word_id': 20, 'word_position': 20, 'active': True},
                        {'word_id': 21, 'word_position': 21, 'active': True},
                        {'word_id': 22, 'word_position': 22, 'active': True}],
              'discriminative_success': [True, True, True, True, True, True, True, True, True, True, False, True, True,
                                         True,
                                         True, True, True, True, True, True, True, True, True, True, True, True, True,
                                         True,
                                         True, True, True, True, True, True, True, True, True, True, True, True, True,
                                         True,
                                         True, True, False, True, False, True, True, True], 'lxc': [
                [0.0, 53769621.39545695, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                 0.0, 0.0, 0.0],
                [0.089060441849856, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                 0.0, 0.0, 0.0],
                [0.0, 0.0, 0.864, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                 0.0],
                [0.0, 0.0, 0.0, 6552.3154680015505, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                 0.0,
                 0.0, 0.0, 0.0],
                [0.0, 1.7915903999999998, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                 0.0,
                 0.0, 0.0, 0.0],
                [0.0, 0.0, 0.0, 0.0, 0.48, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                 0.0],
                [0.10038636664090912, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                 0.0,
                 0.0, 0.0, 0.0],
                [0.0, 0.0, 0.0, 780.215890775219, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                 0.0,
                 0.0, 0.0],
                [0.0, 0.0, 0.0, 0.0, 553018.4862746384, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                 0.0, 0.0, 0.0],
                [0.08207810320882729, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                 0.0,
                 0.0, 0.0, 0.0],
                [0.0, 0.0, 0.0, 0.0, 0.0, 1.1466178560000002, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                 0.0,
                 0.0, 0.0, 0.0],
                [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.4608, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                 0.0],
                [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 2.3776267862016005, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                 0.0,
                 0.0, 0.0, 0.0],
                [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 4187931.1560761924, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                 0.0,
                 0.0, 0.0, 0.0],
                [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 5.3496602689536, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                 0.0,
                 0.0, 0.0],
                [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 2.0639121408, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                 0.0, 0.0],
                [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 9.421848557438913, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                 0.0, 0.0, 0.0],
                [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 295.3341145771217, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                 0.0, 0.0, 0.0],
                [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.1943936, 0.0, 0.0, 0.0, 0.0, 0.0,
                 0.0,
                 0.0],
                [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 15.973999968531144, 0.0, 0.0,
                 0.0,
                 0.0, 0.0, 0.0],
                [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 240.80737369605515, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                 0.0,
                 0.0, 0.0, 0.0],
                [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.4929919999999999, 0.0, 0.0, 0.0, 0.0, 0.0,
                 0.0,
                 0.0, 0.0, 0.0],
                [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 2.1499084799999997,
                 0.0,
                 0.0, 0.0, 0.0]]}
        a1 = {'agent_id': 1, 'categories': [{'category_id': 0, 'is_active': True, 'reactive_units': [45, 39, 39],
                                             'weights': [0.1698828490714725, 0.1714991442663961, 0.4476573682833081]},
                                            {'category_id': 1, 'is_active': True, 'reactive_units': [68],
                                             'weights': [0.01697201484701025]},
                                            {'category_id': 2, 'is_active': True, 'reactive_units': [30],
                                             'weights': [0.016064605132911646]},
                                            {'category_id': 3, 'is_active': True, 'reactive_units': [6, 7, 8, 10, 4],
                                             'weights': [0.2203439735642336, 0.2203652790018537, 0.24593320630462753,
                                                         0.13168418877862684, 0.35858239365736627]},
                                            {'category_id': 4, 'is_active': True, 'reactive_units': [65],
                                             'weights': [0.12276053144307854]},
                                            {'category_id': 5, 'is_active': True, 'reactive_units': [1],
                                             'weights': [0.5848639829047833]},
                                            {'category_id': 6, 'is_active': True, 'reactive_units': [28],
                                             'weights': [0.19747763900818133]},
                                            {'category_id': 7, 'is_active': True, 'reactive_units': [13, 12],
                                             'weights': [0.26000634798920325, 0.2262620057577649]},
                                            {'category_id': 8, 'is_active': True, 'reactive_units': [35],
                                             'weights': [0.09606061293047553]},
                                            {'category_id': 9, 'is_active': True, 'reactive_units': [10],
                                             'weights': [0.08190398485404388]},
                                            {'category_id': 10, 'is_active': True, 'reactive_units': [82],
                                             'weights': [0.2341703491941298]},
                                            {'category_id': 11, 'is_active': True, 'reactive_units': [14],
                                             'weights': [0.14325691493696813]}],
              'words': [{'word_id': 0, 'word_position': 0, 'active': True},
                        {'word_id': 1, 'word_position': 1, 'active': True},
                        {'word_id': 2, 'word_position': 2, 'active': True},
                        {'word_id': 3, 'word_position': 3, 'active': True},
                        {'word_id': 4, 'word_position': 4, 'active': True},
                        {'word_id': 5, 'word_position': 5, 'active': True},
                        {'word_id': 6, 'word_position': 6, 'active': True},
                        {'word_id': 7, 'word_position': 7, 'active': True},
                        {'word_id': 8, 'word_position': 8, 'active': True},
                        {'word_id': 9, 'word_position': 9, 'active': True},
                        {'word_id': 10, 'word_position': 10, 'active': True},
                        {'word_id': 11, 'word_position': 11, 'active': True},
                        {'word_id': 12, 'word_position': 12, 'active': True},
                        {'word_id': 13, 'word_position': 13, 'active': True},
                        {'word_id': 14, 'word_position': 14, 'active': True},
                        {'word_id': 15, 'word_position': 15, 'active': False},
                        {'word_id': 16, 'word_position': 16, 'active': True},
                        {'word_id': 17, 'word_position': 17, 'active': True},
                        {'word_id': 18, 'word_position': 18, 'active': True},
                        {'word_id': 19, 'word_position': 19, 'active': True},
                        {'word_id': 20, 'word_position': 20, 'active': True},
                        {'word_id': 21, 'word_position': 21, 'active': True},
                        {'word_id': 22, 'word_position': 22, 'active': True}],
              'discriminative_success': [True, True, True, True, True, False, True, True, True, True, True, True, True,
                                         True,
                                         True, True, True, True, True, True, True, True, True, True, True, True, True,
                                         True,
                                         True, True, True, True, True, True, True, False, True, True, True, True, True,
                                         True,
                                         True, True, True, True, True, True, True, True],
              'lxc': [[53769621.39545695, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
                      [0.0, 0.089060441849856, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
                      [0.0, 0.864, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
                      [0.0, 6552.3154680015505, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
                      [0.0, 0.0, 1.7915903999999998, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
                      [0.0, 0.0, 0.48, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
                      [0.0, 0.0, 0.0, 0.10038636664090912, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
                      [0.0, 0.0, 0.0, 0.0, 780.215890775219, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
                      [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 553018.4862746384, 0.0, 0.0, 0.0, 0.0, 0.0],
                      [0.0, 0.0, 0.0, 0.0, 0.0, 0.08207810320882729, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
                      [0.0, 1.1466178560000002, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
                      [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.4608, 0.0, 0.0, 0.0, 0.0, 0.0],
                      [0.0, 0.0, 0.0, 0.0, 0.0, 2.3776267862016005, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
                      [0.0, 0.0, 0.0, 0.0, 4187931.1560761924, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
                      [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 5.3496602689536, 0.0, 0.0, 0.0, 0.0, 0.0],
                      [0.0, 0.0, 0.0, 2.0639121408, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
                      [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 9.421848557438913, 0.0, 0.0, 0.0, 0.0, 0.0],
                      [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 295.3341145771217, 0.0, 0.0, 0.0, 0.0],
                      [1.1943936, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
                      [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 15.973999968531144, 0.0, 0.0, 0.0],
                      [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 240.80737369605515, 0.0],
                      [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.4929919999999999],
                      [2.1499084799999997, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]]}

        self.expected_population = [a0, a1]

    def test_result(self):
        game_params = {'population_size': 2, 'stimulus': 'numeric', 'max_num': 100, 'discriminative_threshold': 0.95,
                       'discriminative_history_length': 50, 'delta_inc': 0.2, 'delta_dec': 0.2, 'delta_inh': 0.2,
                       'alpha': 0.01,
                       'super_alpha': 0.001, 'beta': 0.2, 'steps': 1000, 'runs': 1, 'guessing_game_2': False,
                       'in_mem_calculus_path': '', 'seed': 0}
        game_params = GameParams(**game_params)
        steps = game_params.steps
        population_size = game_params.population_size
        seed = game_params.seed

        shuffle_list = shuffle_list_random_function(seed=seed)
        flip_a_coin = flip_a_coin_random_function(seed=seed)
        pick_element = pick_element_random_function(seed=seed)

        calculator = NumericCalculator.load_from_file()
        context_constructor = calculator.context_factory(pick_element=pick_element)
        actual_population = run_simulation(steps, population_size, shuffle_list, game_params, context_constructor,
                                           game_graph_with_stage_7(calculator, game_params, flip_a_coin))

        actual_population = [NewAgent.to_dict(a) for a in actual_population]
        self.assertEqual(actual_population, self.expected_population)

class TestGuessingGameWithQuotientStimulus(unittest.TestCase):
    def setUp(self) -> None:
        self.agent0 = {'agent_id': 0, 'categories': [
            {'category_id': 0, 'is_active': True, 'reactive_units': [(33, 97)], 'weights': [7.01087523358536]},
            {'category_id': 1, 'is_active': True, 'reactive_units': [(31, 53), (53, 83)],
             'weights': [28.100692934545904, 4.417988363032693]},
            {'category_id': 2, 'is_active': True, 'reactive_units': [(39, 41)], 'weights': [13.752407467773597]},
            {'category_id': 3, 'is_active': True, 'reactive_units': [(16, 61), (22, 81)],
             'weights': [13.258326758853338, 3.897266976549445]},
            {'category_id': 4, 'is_active': True, 'reactive_units': [(62, 87), (59, 84)],
             'weights': [10.225906207183641, 2.291260670020086]},
            {'category_id': 5, 'is_active': True, 'reactive_units': [(23, 55)], 'weights': [31.814872602607142]},
            {'category_id': 6, 'is_active': True, 'reactive_units': [(37, 93)], 'weights': [0.070442206452134]},
            {'category_id': 7, 'is_active': True, 'reactive_units': [(13, 35)], 'weights': [0.07333177081605201]},
            {'category_id': 8, 'is_active': True, 'reactive_units': [(19, 29)], 'weights': [0.08723397361831298]},
            {'category_id': 9, 'is_active': True, 'reactive_units': [(43, 91)], 'weights': [7.291944225974668]},
            {'category_id': 10, 'is_active': True, 'reactive_units': [(30, 53)], 'weights': [0.09333563835785183]},
            {'category_id': 11, 'is_active': True, 'reactive_units': [(17, 73)], 'weights': [0.09795540194743284]},
            {'category_id': 12, 'is_active': True, 'reactive_units': [(68, 77)], 'weights': [9.323202415938578]},
            {'category_id': 13, 'is_active': True, 'reactive_units': [(9, 95)], 'weights': [6.90002562036662]},
            {'category_id': 14, 'is_active': True, 'reactive_units': [(73, 100)], 'weights': [0.12674462293003974]},
            {'category_id': 15, 'is_active': True, 'reactive_units': [(69, 100)], 'weights': [0.4373795884460617]},
            {'category_id': 16, 'is_active': True, 'reactive_units': [(58, 99)], 'weights': [0.1224326495174649]},
            {'category_id': 17, 'is_active': True, 'reactive_units': [(1, 97)], 'weights': [11.162161841416474]},
            {'category_id': 18, 'is_active': True, 'reactive_units': [(64, 93)], 'weights': [0.16386137871890202]},
            {'category_id': 19, 'is_active': True, 'reactive_units': [(52, 97)], 'weights': [0.17580460327901132]}],
                       'words': [{'word_id': 0, 'word_position': 0, 'active': False},
                                 {'word_id': 1, 'word_position': 1, 'active': True},
                                 {'word_id': 2, 'word_position': 2, 'active': True},
                                 {'word_id': 3, 'word_position': 3, 'active': False},
                                 {'word_id': 4, 'word_position': 4, 'active': True},
                                 {'word_id': 5, 'word_position': 5, 'active': True},
                                 {'word_id': 6, 'word_position': 6, 'active': True},
                                 {'word_id': 7, 'word_position': 7, 'active': True},
                                 {'word_id': 8, 'word_position': 8, 'active': True},
                                 {'word_id': 9, 'word_position': 9, 'active': True},
                                 {'word_id': 10, 'word_position': 10, 'active': True},
                                 {'word_id': 11, 'word_position': 11, 'active': True},
                                 {'word_id': 12, 'word_position': 12, 'active': False},
                                 {'word_id': 13, 'word_position': 13, 'active': True},
                                 {'word_id': 14, 'word_position': 14, 'active': True},
                                 {'word_id': 15, 'word_position': 15, 'active': True},
                                 {'word_id': 16, 'word_position': 16, 'active': True},
                                 {'word_id': 17, 'word_position': 17, 'active': True},
                                 {'word_id': 18, 'word_position': 18, 'active': True},
                                 {'word_id': 19, 'word_position': 19, 'active': True}],
                       'discriminative_success': [True, True, True, True, True, True, True, True, True, True, True,
                                                  True,
                                                  True, True,
                                                  False, True, True, True, True, True, True, True, True, True, True,
                                                  True,
                                                  True, True,
                                                  True, True, True, True, True, True, True, True, True, True, True,
                                                  True,
                                                  True, True,
                                                  True, True, False, True, True, True, True, True], 'lxc': [
                [0.0, 1.855985899956989, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                 0.0, 0.0],
                [0.05252998605364947, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                 0.0,
                 0.0, 0.0],
                [0.0, 0.0, 624.1727126201752, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                 0.0, 0.0],
                [0.0, 0.0, 0.0, 12.503772907971417, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                 0.0,
                 0.0, 0.0],
                [0.22161087866383372, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                 0.0,
                 0.0, 0.0],
                [0.0, 0.0, 0.0, 0.0, 0.0, 0.1068725302198272, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                 0.0,
                 0.0, 0.0],
                [0.0, 0.0, 0.0, 0.0, 734.8857839845434, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                 0.0, 0.0],
                [0.0, 9435.334273922233, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                 0.0, 0.0],
                [0.0, 0.0, 0.0, 15.973999968531144, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                 0.0,
                 0.0, 0.0],
                [0.0, 0.0, 0.0, 0.0, 0.0, 6290.222849281486, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                 0.0, 0.0],
                [0.0, 0.0, 0.0, 0.0, 0.0, 14.721638370998306, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                 0.0,
                 0.0, 0.0],
                [0.2717908992000001, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                 0.0,
                 0.0, 0.0],
                [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0368, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
                [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 31.79873888135634, 0.0, 0.0, 0.0, 0.0,
                 0.0, 0.0],
                [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.5, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
                [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.864, 0.0, 0.0, 0.0, 0.0],
                [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.5, 0.0, 0.0, 0.0, 0.0, 0.0],
                [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 6.41959232274432, 0.0, 0.0, 0.0, 0.0, 0.0,
                 0.0,
                 0.0],
                [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.5, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
                [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                 2.5798901759999997,
                 0.0, 0.0]]}
        self.agent1 = {'agent_id': 1, 'categories': [
            {'category_id': 0, 'is_active': True, 'reactive_units': [(79, 88)], 'weights': [15.010345302944563]},
            {'category_id': 1, 'is_active': True, 'reactive_units': [(20, 23)], 'weights': [5.377788787254701]},
            {'category_id': 2, 'is_active': True, 'reactive_units': [(65, 89)], 'weights': [33.46446479278934]},
            {'category_id': 3, 'is_active': True, 'reactive_units': [(83, 92)], 'weights': [0.044366166257650816]},
            {'category_id': 4, 'is_active': True, 'reactive_units': [(17, 95)], 'weights': [10.450850683264713]},
            {'category_id': 5, 'is_active': True, 'reactive_units': [(58, 69)], 'weights': [0.044366166257650816]},
            {'category_id': 6, 'is_active': True, 'reactive_units': [(3, 28)], 'weights': [11.729134369653195]},
            {'category_id': 7, 'is_active': True, 'reactive_units': [(56, 99)], 'weights': [9.087213353039122]},
            {'category_id': 8, 'is_active': True, 'reactive_units': [(1, 76)], 'weights': [10.419693051048615]},
            {'category_id': 9, 'is_active': True, 'reactive_units': [(75, 83)], 'weights': [0.0542435382538575]},
            {'category_id': 10, 'is_active': True, 'reactive_units': [(17, 63)], 'weights': [13.729442584813102]},
            {'category_id': 11, 'is_active': True, 'reactive_units': [(24, 61)], 'weights': [23.860620438722776]},
            {'category_id': 12, 'is_active': True, 'reactive_units': [(17, 80)], 'weights': [0.06435017054482783]},
            {'category_id': 13, 'is_active': True, 'reactive_units': [(26, 53), (38, 85), (43, 83), (45, 86)],
             'weights': [17.143035231308943, 4.253589009589369, 12.222293504995193, 11.948157512057197]},
            {'category_id': 14, 'is_active': True, 'reactive_units': [(43, 91)], 'weights': [0.08108494500550344]},
            {'category_id': 15, 'is_active': True, 'reactive_units': [(35, 48)], 'weights': [0.08108494500550344]},
            {'category_id': 16, 'is_active': True, 'reactive_units': [(2, 7)], 'weights': [0.08612496509575086]},
            {'category_id': 17, 'is_active': True, 'reactive_units': [(44, 95)], 'weights': [0.09147825915453059]},
            {'category_id': 18, 'is_active': True, 'reactive_units': [(46, 93)], 'weights': [0.09716429944139768]},
            {'category_id': 19, 'is_active': True, 'reactive_units': [(39, 55)], 'weights': [0.5003166480855388]},
            {'category_id': 20, 'is_active': True, 'reactive_units': [(47, 49)], 'weights': [0.1340233584584372]},
            {'category_id': 21, 'is_active': True, 'reactive_units': [(20, 69)], 'weights': [0.2549928731247828]},
            {'category_id': 22, 'is_active': True, 'reactive_units': [(9, 29)], 'weights': [0.26279824376278116]},
            {'category_id': 23, 'is_active': True, 'reactive_units': [(13, 96)], 'weights': [0.2935183909687424]},
            {'category_id': 24, 'is_active': True, 'reactive_units': [(21, 62)], 'weights': [0.3245513141842012]},
            {'category_id': 25, 'is_active': True, 'reactive_units': [(57, 80)], 'weights': [0.34820660902478684]},
            {'category_id': 26, 'is_active': True, 'reactive_units': [(41, 59)], 'weights': [0.3624901679789268]},
            {'category_id': 27, 'is_active': True, 'reactive_units': [(19, 51)], 'weights': [0.4613723472139601]}],
                       'words': [{'word_id': 0, 'word_position': 0, 'active': False},
                                 {'word_id': 1, 'word_position': 1, 'active': True},
                                 {'word_id': 2, 'word_position': 2, 'active': True},
                                 {'word_id': 3, 'word_position': 3, 'active': False},
                                 {'word_id': 4, 'word_position': 4, 'active': True},
                                 {'word_id': 5, 'word_position': 5, 'active': True},
                                 {'word_id': 6, 'word_position': 6, 'active': True},
                                 {'word_id': 7, 'word_position': 7, 'active': True},
                                 {'word_id': 8, 'word_position': 8, 'active': True},
                                 {'word_id': 9, 'word_position': 9, 'active': True},
                                 {'word_id': 10, 'word_position': 10, 'active': True},
                                 {'word_id': 11, 'word_position': 11, 'active': True},
                                 {'word_id': 12, 'word_position': 12, 'active': False},
                                 {'word_id': 13, 'word_position': 13, 'active': True},
                                 {'word_id': 14, 'word_position': 14, 'active': True},
                                 {'word_id': 15, 'word_position': 15, 'active': True},
                                 {'word_id': 16, 'word_position': 16, 'active': True},
                                 {'word_id': 17, 'word_position': 17, 'active': True},
                                 {'word_id': 18, 'word_position': 18, 'active': True},
                                 {'word_id': 19, 'word_position': 19, 'active': True}],
                       'discriminative_success': [True, True, True, False, True, True, True, True, True, True, True,
                                                  False,
                                                  True,
                                                  True, True, True, False, True, True, True, True, True, True, True,
                                                  True,
                                                  True, True,
                                                  True, True, True, True, True, True, True, True, True, True, True,
                                                  True,
                                                  True, True,
                                                  False, True, True, True, True, True, True, True, True], 'lxc': [
                [0.0, 0.0, 1.855985899956989, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
                [0.05252998605364947, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                 0.0,
                 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
                [0.0, 624.1727126201752, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
                [0.0, 0.0, 0.0, 0.0, 12.503772907971417, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                 0.0,
                 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
                [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.22161087866383372, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                 0.0,
                 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
                [0.1068725302198272, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                 0.0,
                 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
                [0.0, 0.0, 734.8857839845434, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
                [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 9435.334273922233, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
                [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 15.973999968531144, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                 0.0,
                 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
                [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 6290.222849281486, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
                [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 14.721638370998306, 0.0, 0.0, 0.0,
                 0.0,
                 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
                [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.2717908992000001, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                 0.0,
                 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
                [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0368, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                 0.0,
                 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
                [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 31.79873888135634, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
                [0.0, 0.5, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                 0.0,
                 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
                [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.864,
                 0.0,
                 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
                [0.0, 0.5, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                 0.0,
                 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
                [0.0, 6.41959232274432, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                 0.0,
                 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
                [0.0, 0.0, 0.0, 0.0, 0.5, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                 0.0,
                 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
                [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 2.5798901759999997, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                 0.0,
                 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]]}

    def test_result(self):
        game_params = {'population_size': 2, 'stimulus': 'quotient', 'max_num': 100, 'discriminative_threshold': 0.95,
                       'discriminative_history_length': 50, 'delta_inc': 0.2, 'delta_dec': 0.2, 'delta_inh': 0.2,
                       'alpha': 0.01,
                       'super_alpha': 0.001, 'beta': 0.2, 'steps': 1000, 'runs': 1, 'guessing_game_2': False,
                       'in_mem_calculus_path': '', 'seed': 0}
        game_params = GameParams(**game_params)
        steps = game_params.steps
        population_size = game_params.population_size
        seed = game_params.seed

        shuffle_list = shuffle_list_random_function(seed=seed)
        flip_a_coin = flip_a_coin_random_function(seed=seed)
        pick_element = pick_element_random_function(seed=seed)

        calculator = QuotientCalculator.load_from_file()
        context_constructor = calculator.context_factory(pick_element=pick_element)
        actual_population = run_simulation(steps, population_size, shuffle_list, game_params, context_constructor,
                                           game_graph_with_stage_7(calculator, game_params, flip_a_coin))

        actual_population = [NewAgent.to_dict(a) for a in actual_population]
        self.assertEqual(actual_population, [self.agent0, self.agent1])
